import time
import broadlink
from services.HomeService import HomeService


class RMBroadLInk(HomeService):

    def __init__(self):
        rm_config = self.get_config("rm_broad_link")
        self.ip = rm_config['ip']

    def toggle_power(self):
        print("*TOGGLE TV*")
        codeData = "26008c009694133713371436141213121312131213121337133713371312141114111412131213121337131213121312131213121312133714111436143713371337133713371300060d949611391139113a111411141114111411141139113911391114111510151114111411141139111411141114111411141213113a1015103a1139113911391139113911000d05000000000000000000000000"
        self._send_code(codeData=codeData)

    def turn_on_bt_audio(self):
        codeData1 = "2600580000012a95121313371213133712391238123911141337121313371412131213121312133713121312131313121337121313121312133713381337123913121337133713381100052000012a4a12000c600001294b12000d05"
        codeData2 = "260050000001289613121337121413371238133811391213133713121338111413121312131212381312133813121337133714121312131213371213143712131312133813371337120005210001294a12000d050000000000000000"
        self._send_code(codeData=codeData1)
        time.sleep(1)
        self._send_code(codeData=codeData2)


    def turn_on_tv_audio(self):
        codeData1 = "2600580000012a95121313371213133712391238123911141337121313371412131213121312133713121312131313121337121313121312133713381337123913121337133713381100052000012a4a12000c600001294b12000d05"
        codeData2 = "260054000d00049a00012995111413371213133712381239123812131337131213371213121313121312133713371338131213371337121313121213131213121337131213121337133713381300051c0001284b13000d0500000000"
        self._send_code(codeData=codeData1)
        time.sleep(1)
        self._send_code(codeData=codeData2)

    def _send_code(self, codeData=None):
        devices = broadlink.discover(timeout=5, discover_ip_address=self.ip)
        device = devices[0]
        device.auth()
        bytes.fromhex(codeData)
        device.send_data(bytes.fromhex(codeData))

